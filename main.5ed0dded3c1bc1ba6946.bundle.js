(()=>{"use strict";var e,t={6:(e,t,s)=>{s(440);const i={MAX_WIDTH:1e3,MAX_HEIGHT:1e3},a={ROTATION_BARREL_SPEED:2,ROTATION_SPEED:1,MOVEMENT_SPEED:100,BARREL_RADIUS:100,FOCUS_SPEED:20,RELOAD_TIME:1e3,EVENTS:{PLAYER_DIE:"PLAYER_DIE"}},h={SHOOT_PER_TIME:2e3,EVENTS:{ENEMY_DIE:"ENEMY_DIE"}},n={EVENTS:{HEALTH_BAR_CHANGE:"changehealthbar"}},o={EVENTS:{SCORE_ADDED:"scoreadded"},SCORE_ADDED_AMOUNT:20};class r extends Phaser.Scene{constructor(){super({key:"BootScene"})}preload(){this.cameras.main.setBackgroundColor(0),this.createLoadingGraphics(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(8971347,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.pack("preload","./assets/pack.json","preload"),this.load.audio("shootsound","./assets/sounds/shootSound.mp3"),this.load.audio("explosionsound","./assets/sounds/explosion.flac"),this.load.audio("trackmove","./assets/sounds/trackmove.mp3"),this.load.audio("click","./assets/sounds/click.wav")}create(){this.anims.create({key:"flash",frames:[{key:"flash1"},{key:"flash2"},{key:"flash3",duration:50}],frameRate:8,repeat:0}),this.anims.create({key:"explosion",frames:[{key:"explosion1"},{key:"explosion2"},{key:"explosion3"},{key:"explosion4"},{key:"explosion5"},{key:"explosion6"},{key:"explosion7"},{key:"explosion8",duration:50}],frameRate:8,repeat:0})}update(){this.scene.start("MenuScene")}createLoadingGraphics(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(16777215,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}}class l extends Phaser.GameObjects.Image{constructor(e){super(e.scene,e.x,e.y,e.texture),this.rotation=e.rotation,this.initImage(),this.initSprite(),this.initSounds(),this.scene.add.existing(this)}initSounds(){this.explosionSound=this.scene.sound.add("explosionsound")}initImage(){this.bulletSpeed=1e3,this.setOrigin(.5,.5),this.setDepth(2),this.scene.physics.world.enable(this),this.scene.physics.velocityFromRotation(this.rotation-Math.PI/2,this.bulletSpeed,this.body.velocity),this.body.setSize(15,30)}initSprite(){this.explosion=this.scene.add.sprite(0,0,"explosion1"),this.explosion.setScale(.7),this.explosion.setDepth(2),this.explosion.setVisible(!1),this.scene.add.existing(this.explosion),this.explosion.on(Phaser.Animations.Events.ANIMATION_COMPLETE,(()=>{this.explosion.setVisible(!1),this.destroy()}),this)}updateSoundDistance(){if(!this.scene)return;const e=Phaser.Math.Distance.Between(this.scene.cameras.main.midPoint.x,this.scene.cameras.main.midPoint.y,this.x,this.y),t=Phaser.Math.Clamp(1-e/800,0,1);(this.explosionSound instanceof Phaser.Sound.WebAudioSound||this.explosionSound instanceof Phaser.Sound.HTML5AudioSound)&&this.explosionSound.setVolume(t)}playExplosion(){this.explosion.setPosition(this.x,this.y),this.explosion.play("explosion"),this.updateSoundDistance(),this.explosionSound.play(),this.setVisible(!1),this.explosion.setVisible(!0)}update(){}}class c{static lerp(e,t,s){return e+(t-e)*s}static getReflectionVelocity(e,t){const s=e.dot(t);return new Phaser.Math.Vector2(e.x-2*t.x*s,e.y-2*t.y*s)}static normalizeAngle(e){return e-360*Math.floor(e/360)}static shortestAngleDifference(e,t){let s=t-e;return s=c.normalizeAngle(s+180)-180,s}static interpolateColor(e,t,s){let i=Phaser.Display.Color.HexStringToColor(e),a=Phaser.Display.Color.HexStringToColor(t),h=Phaser.Math.Interpolation.Linear([i.red,a.red],s),n=Phaser.Math.Interpolation.Linear([i.green,a.green],s),o=Phaser.Math.Interpolation.Linear([i.blue,a.blue],s);return Phaser.Display.Color.GetColor(h,n,o)}}const d=c;class u extends Phaser.GameObjects.Container{constructor(e,t,s,i,a="",h=100,n=100,o={fontFamily:"Arial",color:"#FFFFFF",fontSize:100,fontStyle:"bold"}){super(e,t,s),this.minScale=.2,this.background=new Phaser.GameObjects.Sprite(this.scene,0,0,i).setOrigin(.5,.5),this.setSize(h,n),this.setInteractive({useHandCursor:!0}),this.pressSound=this.scene.sound.add("click"),this.on("pointerdown",(()=>{this.pressSound.play(),this.downTween&&this.downTween.isPlaying()||(this.downTween=this.scene.tweens.add({targets:this,scaleX:this.minScale,scaleY:this.minScale,duration:50,ease:"Linear",yoyo:!0,onComplete:()=>{this.mainCallback&&this.mainCallback()}}))})),this.on("pointerup",(()=>{this.background.clearTint()})),this.on("pointerover",(()=>{this.background.setTint(262908584)})),this.on("pointerout",(()=>{this.background.clearTint()})),this.add(this.background),this.text=e.add.text(0,0,a,o).setOrigin(.5),this.add(this.text),e.add.existing(this)}setTextPosition(e,t){this.text.setPosition(e,t)}setText(e){this.text.text=e}getText(){return this.text}getBackground(){return this.background}setBackground(e){this.background.setTexture(e)}setMainCallback(e){this.mainCallback=e}toggleBackground(e){this.background.setVisible(e)}}const p=u;class g extends Phaser.GameObjects.Container{constructor(e){super(e,0,0),Phaser.Display.Align.In.Center(this,this.scene.add.zone(0,0,i.MAX_WIDTH-i.MAX_WIDTH/2,i.MAX_HEIGHT)),this.initText(),this.initButtons(),this.initLifeBar(),this.setDepth(10),this.scene.add.existing(this),g.eventEmitter.on(n.EVENTS.HEALTH_BAR_CHANGE,(e=>{this.redrawLifebar(e)}))}initText(){this.score=this.scene.add.text(.7*i.MAX_WIDTH,10,"Score: 100",{fontFamily:"Arial",color:"#FFFFFF",fontSize:40,fontStyle:"bold"}),this.score.setOrigin(0,0),this.score.setScrollFactor(0,0),this.add(this.score)}initLifeBar(){this.lifeBar=this.scene.add.graphics(),this.redrawLifebar(1),this.lifeBar.setScrollFactor(0,0)}initButtons(){this.pauseButton=new p(this.scene,0,0,"pause"),this.pauseButton.setScale(.4),this.pauseButton.setScrollFactor(0,0),this.pauseButton.setMainCallback((()=>{this.scene.scene.pause("GameScene"),this.scene.scene.launch("PauseScene")})),this.add(this.pauseButton),Phaser.Display.Align.In.TopLeft(this.pauseButton,this)}redrawLifebar(e){this.lifeBar.clear(),this.lifeBar.fillStyle(8642374,1),this.lifeBar.fillRect(30,.95*i.MAX_HEIGHT,20,-300*e),this.lifeBar.fillStyle(8642374,1),this.lifeBar.lineStyle(2,16777215),this.lifeBar.strokeRect(30,.95*i.MAX_HEIGHT,20,-300),this.lifeBar.setDepth(10)}toggleUI(e,t=!1){this.lifeBar.setVisible(e),e?(this.setVisible(e),this.setActive(e),this.scene.tweens.add({targets:this,alpha:1,scale:1,duration:500,ease:"Power2"})):(t&&this.setVisible(e),this.scene.tweens.add({targets:this,alpha:0,scale:0,duration:500,ease:"Power2",onComplete:()=>{this.setVisible(e),this.setActive(e)}}))}setScoreText(e){this.currentTextTween&&this.currentTextTween.isPlaying()?this.score.text=e:this.currentTextTween=this.scene.add.tween({targets:this.score,scale:2,ease:"Linear",duration:100,repeat:0,yoyo:!0,onComplete:()=>{this.score.text=e}}),this.score.text=e}}g.eventEmitter=new Phaser.Events.EventEmitter;const m=g;class y extends Phaser.GameObjects.Container{getBullets(){return this.bullets}constructor(e){super(e.scene,e.x,e.y),this.canShoot=!0,this.currentTime=0,this.initImage(),this.initAnim(),this.initInput(),this.initSounds(),this.setTankScale(.5),this.scene.add.existing(this)}initSounds(){this.moveSound=this.scene.sound.add("trackmove")}initInput(){this.registerInput(),this.scene.input.on("pointerdown",(()=>{this.active&&this.handleShooting()}),this)}initImage(){this.health=1,this.lastShoot=0,this.trackLeft=new Phaser.GameObjects.Image(this.scene,-60,0,"track3"),this.add(this.trackLeft),this.trackRight=new Phaser.GameObjects.Image(this.scene,60,0,"track3"),this.add(this.trackRight),this.tank=new Phaser.GameObjects.Image(this.scene,0,-20,"hull03"),this.add(this.tank),this.arrow=new Phaser.GameObjects.Image(this.scene,0,175,"arrow"),this.add(this.arrow),this.arrow.setScale(.25),this.arrow.setAlpha(.3),this.arrow.setAngle(90),this.tank.setOrigin(.5,.5),this.setDepth(0),this.barrel=this.scene.add.image(this.x,this.y,"gun03"),this.barrel.setOrigin(.5,.7),this.barrel.setDepth(2),this.focus=this.scene.add.image(this.x,this.y,"focus"),this.focus.setOrigin(.5,.5),this.focus.setDepth(5),this.focus.setScale(.09),this.scene.add.existing(this.focus),this.circleReloadTime=this.scene.add.graphics(),this.bullets=this.scene.add.group({active:!0,maxSize:10,runChildUpdate:!0}),this.scene.physics.world.enable(this),this.setSize(100,100),this.body.setSize(100,100)}registerInput(){var e,t,s,i;this.rotateKeyLeft=null===(e=this.scene.input.keyboard)||void 0===e?void 0:e.addKey(Phaser.Input.Keyboard.KeyCodes.A),this.rotateKeyRight=null===(t=this.scene.input.keyboard)||void 0===t?void 0:t.addKey(Phaser.Input.Keyboard.KeyCodes.D),this.moveForwardKey=null===(s=this.scene.input.keyboard)||void 0===s?void 0:s.addKey(Phaser.Input.Keyboard.KeyCodes.W),this.moveBackwardKey=null===(i=this.scene.input.keyboard)||void 0===i?void 0:i.addKey(Phaser.Input.Keyboard.KeyCodes.S)}initAnim(){const e=this.getRotatePos();this.flash=this.scene.add.sprite(e.x,e.y,"flash1"),this.flash.setAngle(180),this.flash.setScale(1.4),this.flash.setDepth(1),this.flash.setVisible(!1),this.flash.on(Phaser.Animations.Events.ANIMATION_COMPLETE,(()=>{this.flash.setVisible(!1)}),this),this.flash.on(Phaser.Animations.Events.ANIMATION_START,(()=>{this.flash.setVisible(!0)}),this)}update(e){this.active?(this.handleInput(e),this.updateFlash(),this.updateUI(e),this.barrel.x=this.x,this.barrel.y=this.y):(this.destroy(),this.barrel.destroy())}updateUI(e){if(!this.canShoot){this.circleReloadTime.setVisible(!0),this.currentTime+=e;const t=this.currentTime/(a.RELOAD_TIME/1e3);this.drawCircleFill(t,this.x+75,this.y-75),this.currentTime>=a.RELOAD_TIME/1e3&&(this.canShoot=!0,this.currentTime=0,this.circleReloadTime.setVisible(!1))}}handleInput(e){var t,s,i,h;this.handleRotationBarrelByMouse(e),(null===(t=this.rotateKeyLeft)||void 0===t?void 0:t.isDown)?(this.rotation-=a.ROTATION_SPEED*e,this.moveSound.isPlaying||this.moveSound.play()):(null===(s=this.rotateKeyRight)||void 0===s?void 0:s.isDown)&&(this.rotation+=a.ROTATION_SPEED*e,this.moveSound.isPlaying||this.moveSound.play()),(null===(i=this.moveForwardKey)||void 0===i?void 0:i.isDown)?(this.scene.physics.velocityFromRotation(this.rotation-90*Phaser.Math.DEG_TO_RAD,-a.MOVEMENT_SPEED,this.body.velocity),this.moveSound.isPlaying||this.moveSound.play()):(null===(h=this.moveBackwardKey)||void 0===h?void 0:h.isDown)?(this.scene.physics.velocityFromRotation(this.rotation-90*Phaser.Math.DEG_TO_RAD,+a.MOVEMENT_SPEED,this.body.velocity),this.moveSound.isPlaying||this.moveSound.play()):(this.body.velocity.set(0),this.moveSound.isPlaying&&this.moveSound.stop())}handleRotationBarrelByMouse(e){const t=this.scene.input.activePointer.updateWorldPoint(this.scene.cameras.main),s=t.worldX,i=t.worldY,h=Phaser.Math.Angle.Between(this.x,this.y,s,i)*Phaser.Math.RAD_TO_DEG+90,n=d.normalizeAngle(this.barrel.angle),o=d.normalizeAngle(h);let r=d.shortestAngleDifference(this.barrel.angle,o);if(n==o)return;this.barrel.angle=d.normalizeAngle(this.barrel.angle+r*e*a.ROTATION_BARREL_SPEED);const l=Phaser.Math.Distance.Between(s,i,this.x,this.y),c=this.getRotatePos(l);this.focus.x=Phaser.Math.Linear(this.focus.x,c.x,e*a.FOCUS_SPEED),this.focus.y=Phaser.Math.Linear(this.focus.y,c.y,e*a.FOCUS_SPEED)}handleShooting(){if(this.scene.time.now-this.lastShoot<a.RELOAD_TIME)return;this.scene.cameras.main.shake(20,.005),this.scene.tweens.add({targets:this,props:{alpha:.8},delay:0,duration:5,ease:"Power1",easeParams:null,hold:0,repeat:0,repeatDelay:0,yoyo:!0,paused:!1});const e=this.getRotatePos();this.bullets.getLength()<10&&(this.bullets.add(new l({scene:this.scene,rotation:this.barrel.rotation,x:e.x,y:e.y,texture:"heavyshell"})),this.lastShoot=this.scene.time.now,this.canShoot=!1),this.scene.sound.play("shootsound"),this.flash.play("flash")}updateFlash(){if(!this.flash.visible)return;const e=this.getRotatePos();this.flash.x=e.x,this.flash.y=e.y,this.flash.rotation=this.barrel.rotation}getRotatePos(e=a.BARREL_RADIUS){return{x:Math.cos(this.barrel.rotation-90*Phaser.Math.DEG_TO_RAD)*e+this.barrel.x,y:Math.sin(this.barrel.rotation-90*Phaser.Math.DEG_TO_RAD)*e+this.barrel.y}}updateHealth(){this.health>0&&(this.health-=.05,m.eventEmitter.emit(n.EVENTS.HEALTH_BAR_CHANGE,this.health)),this.health<=0&&(this.health=0,y.eventEmitter.emit(a.EVENTS.PLAYER_DIE),this.moveSound.stop(),this.active=!1),this.createDamageText(this.x+this.displayWidth,this.y-this.displayHeight)}createDamageText(e,t){const s=this.scene.add.text(e,t,"-15",{fontFamily:"Arial",color:"#FF1B00",fontSize:40,fontStyle:"bold"});this.scene.add.tween({targets:s,alpha:0,ease:"Linear",duration:600,repeat:0,yoyo:!1,onComplete:()=>{s.destroy()}})}setTankScale(e){this.setScale(e),this.barrel.setScale(e)}drawCircleFill(e,t,s){this.circleReloadTime.clear(),this.circleReloadTime.lineStyle(2,16777215),this.circleReloadTime.strokeCircle(t,s,15),this.circleReloadTime.fillStyle(6529695,1),this.circleReloadTime.slice(t,s,15,Phaser.Math.DegToRad(270),Phaser.Math.DegToRad(270+360*e),!1),this.circleReloadTime.fillPath()}}y.eventEmitter=new Phaser.Events.EventEmitter;class S extends Phaser.GameObjects.Image{getBarrel(){return this.barrel}getBullets(){return this.bullets}constructor(e){super(e.scene,e.x,e.y,e.texture,e.frame),this.initContainer(),this.initSounds(),this.scene.add.existing(this)}initSounds(){this.shootSound=this.scene.sound.add("shootsound")}initContainer(){this.health=1,this.lastShoot=0,this.speed=100,this.setDepth(0),this.barrel=this.scene.add.image(0,0,"barrelRed"),this.barrel.setOrigin(.5,1),this.barrel.setDepth(1),this.lifeBar=this.scene.add.graphics(),this.redrawLifebar(),this.bullets=this.scene.add.group({active:!0,maxSize:10,runChildUpdate:!0}),this.scene.tweens.add({targets:this,props:{y:this.y-200},delay:0,duration:2e3,ease:"Linear",easeParams:null,hold:0,repeat:-1,repeatDelay:0,yoyo:!0}),this.scene.physics.world.enable(this)}update(){this.updateSoundDistance(),this.active?(this.barrel.x=this.x,this.barrel.y=this.y,this.lifeBar.x=this.x,this.lifeBar.y=this.y,this.handleShooting()):(this.destroy(),this.barrel.destroy(),this.lifeBar.destroy())}updateSoundDistance(){const e=Phaser.Math.Distance.Between(this.scene.cameras.main.midPoint.x,this.scene.cameras.main.midPoint.y,this.x,this.y),t=Phaser.Math.Clamp(1-e/800,0,1);(this.shootSound instanceof Phaser.Sound.WebAudioSound||this.shootSound instanceof Phaser.Sound.HTML5AudioSound)&&this.shootSound.setVolume(t)}handleShooting(){this.scene.time.now>this.lastShoot&&this.bullets.getLength()<10&&(this.bullets.add(new l({scene:this.scene,rotation:this.barrel.rotation,x:this.barrel.x,y:this.barrel.y,texture:"bulletRed"})),this.shootSound.play(),this.lastShoot=this.scene.time.now+h.SHOOT_PER_TIME)}redrawLifebar(){this.lifeBar.clear(),this.lifeBar.fillStyle(15100456,1),this.lifeBar.fillRect(-this.width/2,this.height/2,this.width*this.health,15),this.lifeBar.lineStyle(2,16777215),this.lifeBar.strokeRect(-this.width/2,this.height/2,this.width,15),this.lifeBar.setDepth(1)}updateHealth(){this.health>0&&(this.health-=.3,this.redrawLifebar()),this.health<0&&(this.health=0,this.active=!1,this.emit(h.EVENTS.ENEMY_DIE,o.SCORE_ADDED_AMOUNT)),this.createDamageText(this.x+this.displayWidth/2,this.y-this.displayHeight/2)}createDamageText(e,t){const s=this.scene.add.text(e,t,"-30",{fontFamily:"Arial",color:"#FF1B00",fontSize:40,fontStyle:"bold"});this.scene.add.tween({targets:s,alpha:0,ease:"Linear",duration:600,repeat:0,yoyo:!1,onComplete:()=>{s.destroy()}})}}class b extends Phaser.GameObjects.Image{constructor(e){super(e.scene,e.x,e.y,e.texture),this.initImage(),this.scene.add.existing(this)}initImage(){this.setOrigin(0,0),this.scene.physics.world.enable(this),this.body.setImmovable(!0)}update(){}}class E extends Phaser.GameObjects.Container{constructor(e){super(e),this.initUI(),this.setScrollFactor(0,0),this.setDepth(21),this.scene.add.existing(this),Phaser.Display.Align.In.Center(this,this.scene.add.zone(i.MAX_WIDTH/2,i.MAX_HEIGHT/2,i.MAX_WIDTH,i.MAX_HEIGHT))}initUI(){this.blackout=this.scene.add.graphics(),this.blackout.fillStyle(0,.4),this.blackout.fillRect(0,0,i.MAX_WIDTH,i.MAX_HEIGHT),this.blackout.setDepth(2),this.blackout.setScrollFactor(0,0),this.overText=this.scene.add.text(0,0,"GAME OVER",{fontFamily:"Arial",color:"#FFFFFF",fontSize:60,fontStyle:"bold"}),Phaser.Display.Align.In.Center(this.overText,this),this.toggleUI(!1),this.add(this.overText)}toggleUI(e,t=!1,s=void 0){this.blackout.setVisible(e),e?(this.setVisible(e),this.setActive(e),t||(this.scale=0),this.scene.tweens.add({targets:[this],alpha:1,scale:1,duration:500,ease:"Power2"})):(t&&this.setVisible(e),this.scene.tweens.add({targets:[this],alpha:0,scale:0,duration:500,ease:"Power2",onUpdate:(e,t)=>{e.progress>=.2&&s&&s()},onComplete:()=>{this.setVisible(e),this.setActive(e)}}))}}const I=E;class T{constructor(){this.setCurrentScore(0)}setCurrentScore(e){this.currentScore=e,T.eventEmitter.emit(o.EVENTS.SCORE_ADDED,this.currentScore)}addCurrentScore(e){this.currentScore+=e,T.eventEmitter.emit(o.EVENTS.SCORE_ADDED,this.currentScore)}getCurrentScore(){return this.currentScore}getHighScore(){return this.highScore}saveHighScore(){const e=localStorage.getItem("HighScore");if(e){const t=Number.parseInt(e);t<this.currentScore?(localStorage.setItem("HighScore",this.currentScore.toString()),this.highScore=this.currentScore):this.highScore=t}else this.highScore=this.currentScore,localStorage.setItem("HighScore",this.currentScore.toString())}}T.eventEmitter=new Phaser.Events.EventEmitter;const x=T;class f extends Phaser.Plugins.BasePlugin{constructor(e){super(e),this.isMute=!1}setIsMute(e){this.isMute=e}getIsMute(){return this.isMute}}const P=f;class A extends Phaser.Scene{constructor(){super({key:"GameScene"})}registerEvents(){x.eventEmitter.on(o.EVENTS.SCORE_ADDED,(e=>{this.mainGameUI.setScoreText("SCORE: "+e.toString())}))}init(){}create(){this.checkSounds(),this.fadeIn(),this.events.on("resume",this.handleResume,this),this.createUI(),this.registerEvents(),this.scoreCalculator=new x,this.game.canvas.style.cursor="none",this.map=this.make.tilemap({key:"levelMap"}),this.tileset=this.map.addTilesetImage("tiles"),this.layer=this.map.createLayer("tileLayer",this.tileset,0,0),this.layer.setCollisionByProperty({collide:!0}),this.obstacles=this.add.group({runChildUpdate:!0}),this.enemies=this.add.group({}),this.convertObjects(),this.physics.add.collider(this.player,this.layer),this.physics.add.collider(this.player,this.obstacles),this.physics.add.collider(this.player.getBullets(),this.layer,this.bulletHitLayer,void 0,this),this.physics.add.collider(this.player.getBullets(),this.obstacles,this.bulletHitObstacles,void 0,this),this.enemies.getChildren().forEach((e=>{const t=e;t.on(h.EVENTS.ENEMY_DIE,(e=>{this.scoreCalculator.addCurrentScore(e)})),this.physics.add.overlap(this.player.getBullets(),t,this.playerBulletHitEnemy,void 0,this),this.physics.add.overlap(t.getBullets(),this.player,this.enemyBulletHitPlayer,void 0),this.physics.add.collider(t.getBullets(),this.obstacles,this.bulletHitObstacles,void 0),this.physics.add.collider(t.getBullets(),this.layer,this.bulletHitLayer,void 0)}),this),this.cameras.main.startFollow(this.player),this.cursorImage=this.add.image(0,0,"crosshair"),this.cursorImage.setScale(1.2),this.cursorImage.setDepth(10),this.add.existing(this.cursorImage)}checkSounds(){const e=this.plugins.get("SoundManager");e instanceof P&&(this.sound.mute=e.getIsMute())}handleResume(){this.game.canvas.style.cursor="none"}fadeIn(){this.cameras.main.fadeIn(1e3,0,0,0)}createUI(){this.mainGameUI=new m(this),this.popupOverUI=new I(this),y.eventEmitter.on(a.EVENTS.PLAYER_DIE,(()=>{this.scoreCalculator.saveHighScore(),this.mainGameUI.toggleUI(!1,!0),this.popupOverUI.toggleUI(!0),this.time.delayedCall(2e3,(()=>{this.cameras.main.fadeOut(1e3,0,0,0)}))})),this.cameras.main.once(Phaser.Cameras.Scene2D.Events.FADE_OUT_COMPLETE,(()=>{this.scene.start("OverScene",{currentScore:this.scoreCalculator.getCurrentScore(),highScore:this.scoreCalculator.getHighScore()})}))}update(e,t){t/=1e3,this.updateFakeCursor(),this.player.update(t),this.enemies.getChildren().forEach((e=>{const t=e;if(t.update(),this.player.active&&t.active){const e=Phaser.Math.Angle.Between(t.body.x,t.body.y,this.player.body.x,this.player.body.y);t.getBarrel().angle=(e+Math.PI/2)*Phaser.Math.RAD_TO_DEG}}),this)}updateFakeCursor(){const e=this.input.activePointer.updateWorldPoint(this.cameras.main);this.cursorImage.x=e.worldX,this.cursorImage.y=e.worldY}convertObjects(){var e;(null===(e=this.map.getObjectLayer("objects"))||void 0===e?void 0:e.objects).forEach((e=>{if("player"===e.type)this.player=new y({scene:this,x:e.x,y:e.y,texture:"tankBlue"});else if("enemy"===e.type){const t=new S({scene:this,x:e.x,y:e.y,texture:"tankRed"});this.enemies.add(t)}else{const t=new b({scene:this,x:e.x,y:e.y-40,texture:e.type});this.obstacles.add(t)}}))}bulletHitLayer(e){e instanceof l&&(e.playExplosion(),e.destroy())}bulletHitObstacles(e,t){e instanceof l&&(e.playExplosion(),e.destroy())}enemyBulletHitPlayer(e,t){e instanceof l&&(e.playExplosion(),e.destroy()),t.updateHealth()}playerBulletHitEnemy(e,t){e instanceof l&&(e.playExplosion(),e.destroy()),t.updateHealth()}}class v extends Phaser.GameObjects.Container{constructor(e){super(e,0,0),this.initUI(),this.setDepth(10),this.scene.add.existing(this),Phaser.Display.Align.In.Center(this,this.scene.add.zone(i.MAX_WIDTH/2,i.MAX_HEIGHT/2,i.MAX_WIDTH,i.MAX_HEIGHT))}initUI(){this.panel=this.scene.add.image(0,0,"orangepanel"),this.panel.setScale(.37),this.panel.setVisible(!1),this.add(this.panel),Phaser.Display.Align.In.Center(this.panel,this),this.playGameButton=new p(this.scene,0,-100,"orangebutton2","CLICK HERE TO PLAY GAME",1150,300),this.playGameButton.toggleBackground(!1),this.add(this.playGameButton),this.playGameButton.setScale(.3),Phaser.Display.Align.In.Center(this.playGameButton,this.panel),this.scene.tweens.add({targets:this.playGameButton.getText(),alpha:0,duration:500,ease:"Linear",yoyo:!0,repeat:-1}),this.setScale(0),this.toggleUI(!0),this.initDirection()}initDirection(){this.moveTile=this.scene.add.text(0,0,"MOVE",{fontFamily:"Arial",color:"#FFFFFF",fontSize:35,fontStyle:"bold"}),this.add(this.moveTile),this.wKeyboardImage=this.scene.add.image(0,0,"w"),this.add(this.wKeyboardImage),this.sKeyboardImage=this.scene.add.image(0,0,"s"),this.add(this.sKeyboardImage),this.rotateTile=this.scene.add.text(0,0,"ROTATE",{fontFamily:"Arial",color:"#FFFFFF",fontSize:35,fontStyle:"bold"}),this.add(this.rotateTile),this.aKeyboardImage=this.scene.add.image(0,0,"a"),this.add(this.aKeyboardImage),this.dKeyboardImage=this.scene.add.image(0,0,"d"),this.add(this.dKeyboardImage),this.fireTile=this.scene.add.text(0,0,"FIRE",{fontFamily:"Arial",color:"#FFFFFF",fontSize:35,fontStyle:"bold"}),this.add(this.fireTile),this.fireImage=this.scene.add.image(0,0,"fire"),this.add(this.fireImage);const e=this.scene.add.zone(0,i.MAX_HEIGHT/4,500,300),t=this.scene.add.zone(210,.3*i.MAX_HEIGHT,125,100),s=this.scene.add.zone(0,.3*i.MAX_HEIGHT,125,100),a=this.scene.add.zone(-200,.3*i.MAX_HEIGHT,125,100);Phaser.Display.Align.In.BottomLeft(this.moveTile,e),Phaser.Display.Align.In.BottomCenter(this.rotateTile,e),Phaser.Display.Align.In.BottomRight(this.fireTile,e),Phaser.Display.Align.In.TopCenter(this.fireImage,t),Phaser.Display.Align.In.TopLeft(this.wKeyboardImage,a),Phaser.Display.Align.In.TopRight(this.sKeyboardImage,a),Phaser.Display.Align.In.TopLeft(this.aKeyboardImage,s),Phaser.Display.Align.In.TopRight(this.dKeyboardImage,s)}registerPlayButton(e){this.playGameButton.setMainCallback(e)}toggleUI(e,t=!1){e?(this.setVisible(e),this.setActive(e),this.scene.tweens.add({targets:this,alpha:1,scale:1,duration:500,ease:"Power2"})):(t&&this.setVisible(e),this.scene.tweens.add({targets:this,alpha:0,scale:0,duration:500,ease:"Power2",onComplete:()=>{this.setVisible(e),this.setActive(e)}}))}}const D=v;class w extends Phaser.Scene{constructor(){super({key:"MenuScene"})}init(){}create(){this.fadeIn(),this.checkSounds();const e=this.add.image(0,0,"bg");e.setOrigin(0,0),e.setScale(.7),this.menuUI=new D(this),this.menuUI.registerPlayButton((()=>{this.cameras.main.fadeOut(1e3,0,0,0)})),this.cameras.main.once(Phaser.Cameras.Scene2D.Events.FADE_OUT_COMPLETE,(()=>{this.scene.start("GameScene")}))}checkSounds(){const e=this.plugins.get("SoundManager");e instanceof P&&(this.sound.mute=e.getIsMute())}fadeIn(){this.cameras.main.fadeIn(1e3,0,0,0)}}class B extends Phaser.GameObjects.Container{constructor(e){super(e,0,0),this.currentHighScore=0,this.maxHighScore=0,this.currentScore=0,this.maxCurrentScore=0,this.initUI(),this.setDepth(10),this.scene.add.existing(this),Phaser.Display.Align.In.Center(this,this.scene.add.zone(i.MAX_WIDTH/2,i.MAX_HEIGHT/2,i.MAX_WIDTH,i.MAX_HEIGHT))}initUI(){const e=this.scene.add.image(0,0,"overbg");e.setScale(.66),e.setOrigin(0,0),this.panel=this.scene.add.image(0,0,"greypanel"),this.panel.setScale(.37),this.add(this.panel),Phaser.Display.Align.In.Center(this.panel,this);const t=this.scene.add.zone(0,0,1e3,1e3);this.pauseImage=this.scene.add.image(0,-275,"bannerblue"),this.pauseImage.setScale(.5,.3),this.add(this.pauseImage),Phaser.Display.Align.In.TopCenter(this.pauseImage,t);const s=[];this.pauseText=this.scene.add.text(0,-20,"GAME OVER",{fontFamily:"Arial",color:"#FFFFFF",fontSize:60,fontStyle:"bold"}),this.add(this.pauseText),Phaser.Display.Align.In.Center(this.pauseText,this.pauseImage),this.highScoreText=this.scene.add.text(0,-150,"HIGH SCORE: 0",{fontFamily:"Arial",color:"#FFFFFF",fontSize:45,fontStyle:"bold"}),this.add(this.highScoreText),this.highScoreText.setOrigin(.5,.5),this.currentScoreText=this.scene.add.text(0,-20,"YOUR SCORE: 0",{fontFamily:"Arial",color:"#FFFFFF",fontSize:45,fontStyle:"bold"}),this.currentScoreText.setOrigin(.5,.5),this.add(this.currentScoreText),this.newGameButton=new p(this.scene,0,100,"orangebutton2","NEW GAME",1200,300),this.add(this.newGameButton),this.newGameButton.setScale(.35),s.push(this.highScoreText),s.push(this.currentScoreText),s.push(this.newGameButton);const i=this.scene.add.image(0,40,"over");i.setScale(.2),i.setOrigin(.5,.5),this.add(i),Phaser.Actions.AlignTo(s,Phaser.Display.Align.BOTTOM_CENTER,0,50),this.toggleUI(!0),this.registerButtons()}toggleUI(e,t=!1,s=void 0){e?(this.setVisible(e),this.setActive(e),t||(this.scale=0),this.scene.tweens.add({targets:[this],alpha:1,scale:1,duration:500,ease:"Power2"})):(t&&this.setVisible(e),this.scene.tweens.add({targets:[this],alpha:0,scale:0,duration:500,ease:"Power2",onUpdate:(e,t)=>{e.progress>=.2&&s&&s()},onComplete:()=>{this.setVisible(e),this.setActive(e)}}))}registerButtons(){this.newGameButton.setMainCallback((()=>{this.toggleUI(!1,!1,(()=>{const e=this.scene.cameras.main.postFX.addWipe(.3,1,1);this.scene.scene.transition({target:"GameScene",duration:1e3,moveBelow:!0,onUpdate:t=>{e.progress=t}})}))}))}setHighScoreText(e){this.highScoreText.text=e}setCurrentScoreText(e){this.currentScoreText.text=e}setHighScore(e){this.maxHighScore=e,this.currentHighScore=0,this.highScoreTimer=this.scene.time.addEvent({delay:10,callback:this.updateHighScore,callbackScope:this,loop:!0})}updateHighScore(){this.currentHighScore++,this.setHighScoreText("HIGH SCORE: "+this.currentHighScore.toString()),this.currentHighScore>=this.maxHighScore&&this.highScoreTimer.remove(!1)}setCurrentScore(e){this.maxCurrentScore=e,this.currentScore=0,this.currentScoreTimer=this.scene.time.addEvent({delay:10,callback:this.updateCurrentScore,callbackScope:this,loop:!0})}updateCurrentScore(){this.currentScore++,this.setCurrentScoreText("YOUR SCORE: "+this.currentScore.toString()),this.currentScore>=this.maxCurrentScore&&this.currentScoreTimer.remove(!1)}}const M=B;class C extends Phaser.Scene{constructor(){super({key:"OverScene"})}create(e){this.checkSounds(),this.fadeIn(),this.overUI=new M(this),this.overUI.setCurrentScore(e.currentScore),this.overUI.setHighScore(e.highScore)}fadeIn(){this.cameras.main.fadeIn(1e3,0,0,0)}checkSounds(){const e=this.plugins.get("SoundManager");e instanceof P&&(this.sound.mute=e.getIsMute())}}const O=C;class k extends Phaser.GameObjects.Container{constructor(e){super(e,0,0),this.soundState=!0,this.initUI(),this.setDepth(10),this.scene.add.existing(this),Phaser.Display.Align.In.Center(this,this.scene.add.zone(i.MAX_WIDTH/2,i.MAX_HEIGHT/2,i.MAX_WIDTH,i.MAX_HEIGHT))}initUI(){this.panel=this.scene.add.image(0,0,"greypanel"),this.panel.setScale(.37),this.add(this.panel),Phaser.Display.Align.In.Center(this.panel,this);const e=this.scene.add.zone(0,0,1e3,800);this.pauseImage=this.scene.add.image(0,-275,"greybutton"),this.pauseImage.setScale(.6),this.add(this.pauseImage),Phaser.Display.Align.In.TopCenter(this.pauseImage,e),this.pauseText=this.scene.add.text(0,0,"PAUSED",{fontFamily:"Arial",color:"#FFFFFF",fontSize:60,fontStyle:"bold"}),this.add(this.pauseText),Phaser.Display.Align.In.Center(this.pauseText,this.pauseImage),this.closeButton=new p(this.scene,0,0,"closebutton","",500,300),this.add(this.closeButton),this.closeButton.setScale(.35),Phaser.Display.Align.In.TopRight(this.closeButton,e);const t=[];this.continueGameButton=new p(this.scene,0,-125,"orangebutton2","CONTINUE",1200,300),this.add(this.continueGameButton),this.continueGameButton.setScale(.35),this.newGameButton=new p(this.scene,0,0,"orangebutton2","NEW GAME",1200,300),this.add(this.newGameButton),this.newGameButton.setScale(.35),this.mainMenuButton=new p(this.scene,0,0,"orangebutton2","MENU",1200,300),this.add(this.mainMenuButton),this.mainMenuButton.setScale(.35),this.soundButton=new p(this.scene,-225,-200,"audiobutton","",200,200),this.add(this.soundButton),this.soundButton.setScale(.35),t.push(this.continueGameButton),t.push(this.newGameButton),t.push(this.mainMenuButton),Phaser.Actions.AlignTo(t,Phaser.Display.Align.BOTTOM_CENTER,0,-150),this.blackout=this.scene.add.graphics(),this.blackout.fillStyle(0,.4),this.blackout.fillRect(0,0,i.MAX_WIDTH,i.MAX_HEIGHT),this.blackout.setDepth(2),this.toggleUI(!0),this.registerButtons()}registerPlayButton(e){this.continueGameButton.setMainCallback(e)}toggleUI(e,t=!1,s=void 0){this.blackout.setVisible(e),e?(this.setVisible(e),this.setActive(e),t||(this.scale=0),this.scene.tweens.add({targets:[this],alpha:1,scale:1,duration:500,ease:"Power2"})):(t&&this.setVisible(e),this.scene.tweens.add({targets:[this],alpha:0,scale:0,duration:500,ease:"Power2",onUpdate:(e,t)=>{e.progress>=.2&&s&&s()},onComplete:()=>{this.setVisible(e),this.setActive(e)}}))}registerButtons(){this.closeButton.setMainCallback((()=>{this.toggleUI(!1,!1,(()=>{this.scene.scene.stop("PauseScene"),this.scene.scene.resume("GameScene")}))})),this.continueGameButton.setMainCallback((()=>{this.toggleUI(!1,!1,(()=>{this.scene.scene.stop("PauseScene"),this.scene.scene.resume("GameScene")}))})),this.newGameButton.setMainCallback((()=>{this.toggleUI(!1,!1,(()=>{this.scene.cameras.main.fadeOut(1e3,0,0,0)}))})),this.mainMenuButton.setMainCallback((()=>{this.toggleUI(!1,!1,(()=>{this.scene.scene.stop("PauseScene"),this.scene.scene.stop("GameScene"),this.scene.scene.start("MenuScene")}))})),this.soundButton.setMainCallback((()=>{this.soundState=!this.soundState,this.soundButton.setBackground(this.soundState?"audiobutton":"audiooffbutton");const e=this.scene.plugins.get("SoundManager");e instanceof P&&(e.setIsMute(!this.soundState),this.scene.sound.mute=!this.soundState)}))}toggleSound(e){this.soundState=!e,this.soundButton.setBackground(this.soundState?"audiobutton":"audiooffbutton")}}const H=k;class _ extends Phaser.Scene{constructor(){super({key:"PauseScene"})}create(){this.pauseUI=new H(this),this.checkSounds(),this.cameras.main.once(Phaser.Cameras.Scene2D.Events.FADE_OUT_COMPLETE,(()=>{this.scene.start("GameScene")}))}checkSounds(){const e=this.plugins.get("SoundManager");e instanceof P&&(this.sound.mute=e.getIsMute(),this.pauseUI.toggleSound(this.sound.mute))}}const F=_,R={title:"Tank",url:"https://github.com/digitsensitive/phaser3-typescript",version:"0.0.1",width:i.MAX_WIDTH,height:i.MAX_HEIGHT,zoom:.5,type:Phaser.AUTO,parent:"game",scene:[r,w,A,F,O],input:{keyboard:!0},physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},plugins:{global:[{key:"SoundManager",plugin:P,start:!0}]},backgroundColor:"#4974a5",render:{antialias:!0}};class G extends Phaser.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new G(R)}))}},s={};function i(e){var a=s[e];if(void 0!==a)return a.exports;var h=s[e]={exports:{}};return t[e].call(h.exports,h,h.exports,i),h.exports}i.m=t,e=[],i.O=(t,s,a,h)=>{if(!s){var n=1/0;for(c=0;c<e.length;c++){for(var[s,a,h]=e[c],o=!0,r=0;r<s.length;r++)(!1&h||n>=h)&&Object.keys(i.O).every((e=>i.O[e](s[r])))?s.splice(r--,1):(o=!1,h<n&&(n=h));if(o){e.splice(c--,1);var l=a();void 0!==l&&(t=l)}}return t}h=h||0;for(var c=e.length;c>0&&e[c-1][2]>h;c--)e[c]=e[c-1];e[c]=[s,a,h]},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={792:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var a,h,[n,o,r]=s,l=0;if(n.some((t=>0!==e[t]))){for(a in o)i.o(o,a)&&(i.m[a]=o[a]);if(r)var c=r(i)}for(t&&t(s);l<n.length;l++)h=n[l],i.o(e,h)&&e[h]&&e[h][0](),e[h]=0;return i.O(c)},s=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var a=i.O(void 0,[96],(()=>i(6)));a=i.O(a)})();